<!DOCTYPE html>
{% extends "index.html" %}
{% load static %}
{% block main_content %}

<div
  class="container-flex text-center justify-content-center align-items-center"
  style="padding-top: 10px; padding-bottom: 20px; margin-top: 10px; vertical-align: middle;"
>
  <div class="row justify-content-center align-middle" style="margin-top: 10px; height: 60px">
    <div class="col-md-4 text-light" style="background: #4b088a">
      <h4 style="margin-top: 15px">Register new reader</h4>
    </div>
    <div class="col-md-8">
      <h4>Search readers</h4>
    </div>
  </div>

  <div class="row">
    <!-- Register Reader -->
    <div class="col-md-4">
      <div class="container" style="overflow-y: auto; height: 600px; background: #ceecf5">
        <form class="d-flex" action="/readers/add" method="POST">
          {% csrf_token %}
          <table class="table" style="margin-top: 20px">
            <tr>
              <td style="text-align: left; vertical-align: middle; padding-left: 15px;">Name :</td>
              <td><input type="text" class="form-control" name="reader_name" /></td>
            </tr>
            <tr>
              <td style="text-align: left; vertical-align: middle; padding-left: 15px;">Contact :</td>
              <td><input type="text" class="form-control" name="reader_contact" /></td>
            </tr>
            <tr>
              <td style="text-align: left; vertical-align: middle; padding-left: 15px;">Reference ID :</td>
              <td><input type="text" class="form-control" name="reader_ref_id" /></td>
            </tr>
            <tr>
              <td style="text-align: left; vertical-align: middle; padding-left: 15px;">Address :</td>
              <td><input type="text" class="form-control" name="reader_address" /></td>
            </tr>
            <tr>
              <td colspan="2">
                <button class="btn btn-primary" type="submit">Save</button>
              </td>
            </tr>
          </table>
        </form>
        <ul style="text-align: left; vertical-align: middle; padding-left: 15px">
          <li><small>Readers should not register multiple times</small></li>
          <li><small>Duplicate reader registration will be deactivated</small></li>
          <li><small>Contact Information provided must be correct and subject to verification</small></li>
        </ul>
      </div>
    </div>

    <!-- Search & Table -->
    <div class="col-md-8">
      <div class="row">
        <nav class="navbar bg-body-light">
          <div class="container-fluid justify-content-center align-items-center">
            <form class="d-flex" role="search" action="/readers" method="POST">
              {% csrf_token %}
              <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" name="query" value="{{ query }}" />
              <button class="btn btn-outline-primary" type="submit">Search</button>
            </form>
          </div>
        </nav>
      </div>

      <div class="row" style="margin-top: 20px">
        <p>{{ readers.paginator.count }} readers subscribed.</p>

        <form method="post" action="{% url 'export_readers' %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-success">Export to S3</button>
        </form>

        <style>
          .scrollable-table {
            height: 400px;
            overflow-y: auto;
            display: block;
          }
          .scrollable-table table {
            width: 100%;
            border-collapse: collapse;
          }
          .scrollable-table thead th {
            position: sticky;
            top: 0;
            background-color: #f8f9fa;
            z-index: 10;
          }
          .scrollable-table tbody td {
            background-color: #fff;
          }
        </style>

        <div class="row" style="margin-top: 20px">
          <div class="scrollable-table">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Reader ID</th>
                  <th>Name</th>
                  <th>Contact</th>
                  <th>Reference ID</th>
                  <th>Address</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for reader in readers %}
                <tr>
                  <td>{{ reader.id }}</td>
                  <td>
                    {% if reader.active %}
                      <span class="btn btn-success">{{ reader.reader_name }}</span>
                    {% else %}
                      <span class="btn btn-secondary">{{ reader.reader_name }}</span>
                    {% endif %}
                  </td>
                  <td>{{ reader.reader_contact }}</td>
                  <td>{{ reader.reference_id }}</td>
                  <td>{{ reader.reader_address }}</td>
                  <td>
                    <a href="/readers/edit/{{ reader.id }}?page={{ readers.number }}" class="btn btn-sm btn-primary">Edit</a>
                    <a href="/readers/delete/{{ reader.id }}?page={{ readers.number }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this reader?')">Delete</a>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6">No readers found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        <!-- Pagination Controls -->
        <div class="mt-3 d-flex justify-content-center align-items-center">
          <nav aria-label="Page navigation" class="d-flex align-items-center gap-2">
            <!-- Previous Button -->
            {% if readers.has_previous %}
            <li class="page-item list-unstyled">
              <a class="btn btn-sm btn-outline-primary" href="?page={{ readers.previous_page_number }}{% if query %}&query={{ query }}{% endif %}">Previous</a>
            </li>
            {% else %}
            <li class="page-item list-unstyled disabled">
              <span class="btn btn-sm btn-outline-secondary">Previous</span>
            </li>
            {% endif %}

            <!-- Page Numbers -->
            <div style="overflow-x: auto; white-space: nowrap; max-width: 300px">
              <ul class="pagination mb-0">
                {% for num in readers.paginator.page_range %}
                  {% if readers.number == num %}
                    <li class="page-item active">
                      <span class="page-link">{{ num }}</span>
                    </li>
                  {% else %}
                    <li class="page-item">
                      <a class="page-link" href="?page={{ num }}{% if query %}&query={{ query }}{% endif %}">{{ num }}</a>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>

            <!-- Next Button -->
            {% if readers.has_next %}
            <li class="page-item list-unstyled">
              <a class="btn btn-sm btn-outline-primary" href="?page={{ readers.next_page_number }}{% if query %}&query={{ query }}{% endif %}">Next</a>
            </li>
            {% else %}
            <li class="page-item list-unstyled disabled">
              <span class="btn btn-sm btn-outline-secondary">Next</span>
            </li>
            {% endif %}
          </nav>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
